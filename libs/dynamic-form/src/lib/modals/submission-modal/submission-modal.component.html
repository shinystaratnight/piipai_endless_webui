<webui-dialog [title]="'Worksheet submission' | translate">
  <div class="content" dialog-content>
    <section class="details">
      <div class="details__person">
        <img
          class="avatar"
          [src]="timeSheet.candidate.avatar.origin"
          alt="timeSheet.candidate.fullName"
        />

        <div>
          <h5 class="title">{{ timeSheet.candidate.fullName }}</h5>

          <p *ngIf="timeSheet.candidate.email">
            {{ timeSheet.candidate.email }}
          </p>
        </div>
      </div>

      <div class="details__info">
        <div *ngFor="let column of info" class="details__info-section">
          <div *ngFor="let record of column" class="details__info-row">
            <webui-icon [icon]="record.icon"></webui-icon>

            <div class="field">
              <b class="label">
                {{ record.label | translate }}
              </b>

              <span class="content-text">{{ record.text }}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <form *ngIf="formGroup" [formGroup]="formGroup" class="form" (ngSubmit)="submitForm()">
      <section class="times">
        <header class="times__header">
          <h4 class="section-title">{{ 'time' | translate }}</h4>

          <span class="total-time">{{ timeSheet.totalTime }}</span>
        </header>

        <div class="form-row">
          <webui-form-datepicker-control
            formControlName="shiftStartedAt"
            [type]="DatepickerType.DateTime"
            [initialValue]="timeSheet.startedAt"
            [timezone]="timeSheet.timezone"
            [label]="'start_time' | translate"
          ></webui-form-datepicker-control>

          <webui-form-datepicker-control
            formControlName="shiftEndedAt"
            [initialValue]="timeSheet.endedAt"
            [timezone]="timeSheet.timezone"
            [type]="DatepickerType.DateTime"
            [label]="'end_time' | translate"
          ></webui-form-datepicker-control>
        </div>

        <div class="form-row">
          <webui-form-datepicker-control
            formControlName="break"
            [initialValue]="timeSheet.startedAt"
            [timerFrom]="timeSheet.breakStartedAt"
            [timerTo]="timeSheet.breakEndedAt"
            [type]="DatepickerType.Timer"
            [label]="'break_time' | translate"
          ></webui-form-datepicker-control>

          <span>&nbsp;</span>
        </div>
      </section>

      <section class="activities">
        <h4 class="section-title">
          {{ 'activity' | translate }}
          <button
            type="button"
            class="plus-button"
            [disabled]="!hasActivities"
            (click)="addActivityControl()"
          >
            <webui-icon [icon]="Icon.Plus" [size]="IconSize.Large"></webui-icon>
          </button>
        </h4>

        <ng-container *ngIf="hasActivities">
          <div [formGroup]="activity" *ngFor="let activity of activitiesForm; let index = index">
            <div class="form-row">
              <webui-form-dropdown-control
                formControlName="worktype"
                [url]="activityEndpoint"
                [label]="'your_activity' | translate"
                [params]="activityParams"
                [optionFilter]="activityOptionFilter"
              ></webui-form-dropdown-control>

              <button type="button" class="delete-button" (click)="removeActivity(activity, index)">
                <webui-icon [icon]="Icon.Delete"></webui-icon>
              </button>
            </div>

            <div class="form-row">
              <webui-form-input-control
                *ngIf="activity.get('value')"
                [label]="'amount' | translate"
                [prefix]="getAmountPrefix(activity)"
                type="number"
                formControlName="value"
              ></webui-form-input-control>
            </div>
          </div>
        </ng-container>

        <div *ngIf="!hasActivities" class="activities-empty">
          <app-loader class="loader"></app-loader>
        </div>
      </section>

      <footer class="footer">
        <button
          class="btn submit-btn"
          [disabled]="formInvalid || (processing$ | async)"
          type="submit"
        >
          {{ 'submit' | translate }}

          <app-spinner *ngIf="processing$ | async"></app-spinner>
        </button>
      </footer>
    </form>
  </div>
</webui-dialog>
