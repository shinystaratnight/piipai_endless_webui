<div
  class="form-group"
  *ngIf="!config.hide"
  [class.mb-0]="config.templateOptions.bottom"
  [formGroup]="group"
  style="position: relative"
>
  <div class="form-element" [class.inline]="config.templateOptions.inline">
    <label
      class="form-element-label"
      *ngIf="label && config.templateOptions.label"
      [class.inline]="config.templateOptions.inline"
      [ngClass]="[
        config.templateOptions.inline ? config.templateOptions.color : ''
      ]"
      [class.bold]="config.templateOptions.bold"
      [class.required]="config.templateOptions.required"
      [attr.for]="key"
    >
      {{ config.templateOptions.label }}:
    </label>
    <app-info [description]="config.templateOptions.description"></app-info>
    <div
      class="form-element-content edit"
      [class.showAll]="viewMode || config.type === 'static'"
      [class.full]="config.templateOptions.addon"
    >
      <span class="input-icon" *ngIf="config.templateOptions.icon">
        {{ config.templateOptions.icon }}
      </span>

      <ng-container *ngIf="!viewMode && isPhoneField">
        <ng-container *ngTemplateOutlet="phoneField"></ng-container>
      </ng-container>

      <ng-container
        *ngIf="
          (this.config.type !== 'static' ||
            (this.config.type === 'static' && !this.config.read_only)) &&
          (!viewMode && !config.read_only) &&
          !isAddressField &&
          !isPhoneField &&
          config.templateOptions.type !== 'score'
        "
      >
        <ng-container *ngTemplateOutlet="inputField"></ng-container>
      </ng-container>

      <ng-container
        *ngIf="config.type !== 'static' && !viewMode && isAddressField"
      >
        <ng-container *ngTemplateOutlet="addressField"></ng-container>
      </ng-container>

      <ng-container
        *ngIf="
          !viewMode &&
          !config.read_only &&
          config.templateOptions.type === 'score'
        "
      >
        <ng-container *ngTemplateOutlet="scoreField"></ng-container>
      </ng-container>

      <!-- <input
        *ngIf="
          (this.config.type !== 'static' ||
            (this.config.type === 'static' && !this.config.read_only)) &&
          (!viewMode && !config.read_only) &&
          !isAddressField &&
          config.templateOptions.type !== 'score'
        "
        class="form-control"
        appInputFocus
        [class.pl-2]="config.templateOptions.icon"
        [class.not-empty]="group.get(key).value"
        autocomplete="off"
        #input
        (focus)="generateList()"
        (keyup)="filter(key)"
        [class.addon-input]="config.templateOptions.addon"
        [formControlName]="key"
        [attr.type]="
          config.templateOptions.type
            ? (config.templateOptions.type === 'score' && 'number') ||
              config.templateOptions.type
            : 'text'
        "
        [attr.id]="key"
        [attr.name]="key"
        [attr.placeholder]="
          !config.templateOptions.label
            ? config.templateOptions.placeholder
            : ''
        "
        [readonly]="config.read_only"
        [value]="
          config.value === 0 || config.value
            ? config.value
            : group.get(key).value === 0 || group.get(key).value
            ? group.get(key).value
            : ''
        "
      /> -->

      <!-- <input
        type="text"
        class="form-control"
        id="autocomplete"
        #adr
        *ngIf="config.type !== 'static' && !viewMode && isAddressField"
        ngx-google-places-autocomplete
        [(ngModel)]="address"
        [ngModelOptions]="{ standalone: true }"
        [attr.id]="key"
        [attr.name]="key"
        (onAddressChange)="getAddress($event, adr.value)"
      /> -->

      <!-- <ngb-rating
        *ngIf="
          !viewMode &&
          !config.read_only &&
          config.templateOptions.type === 'score'
        "
        max="5"
        (hover)="hovered = $event"
        (leave)="hovered = undefined"
        (rateChange)="hovered = undefined"
        [formControl]="group.get(key)"
      >
        <ng-template let-fill="fill" let-index="index">
          <span
            *ngIf="fill === 100"
            [style.color]="colors[hovered || group.get(key).value]"
            class="star full"
            >&#9733;</span
          >
          <span
            *ngIf="fill === 0"
            [class.text-danger]="!hovered && !group.get(key).value"
            class="star"
            >{{ group.get(key).value ? '&#9733;' : '&#9734;' }}</span
          >
          <span
            *ngIf="fill < 100 && fill > 0"
            [class.text-danger]="!group.get(key).value"
            class="star"
          >
            <span class="half" [style.width.%]="fill">
              {{ group.get(key).value ? '&#9733;' : '&#9734;' }} </span
            >{{ group.get(key).value ? '&#9733;' : '&#9734;' }}</span
          >
        </ng-template>
      </ngb-rating>

      <span
        class="score"
        *ngIf="
          !viewMode &&
          !config.read_only &&
          config.templateOptions.type === 'score'
        "
        [style.borderColor]="colors[hovered || group.get(key).value]"
        [style.color]="colors[hovered || group.get(key).value]"
      >
        <span *ngIf="!hovered && !group.get(key).value" class="text-danger">
          {{ config.templateOptions.noneValue }}
        </span>
        <span
          class="d-flex align-items-center"
          *ngIf="hovered || group.get(key).value"
        >
          &nbsp;
          {{ hovered || group.get(key).value | number: '1.1-1' }}
          &nbsp;
          <fa-icon [icon]="['fas', 'star']"></fa-icon>
        </span>
      </span> -->

      <div
        class="autocomplete"
        [hidden]="!(filteredList && filteredList.length) || hideAutocomplete"
      >
        <div
          class="autocomplete-list"
          infinite-scroll
          [infiniteScrollDistance]="modalScrollDistance"
          [infiniteScrollThrottle]="modalScrollThrottle"
          [scrollWindow]="false"
          (scrolled)="onModalScrollDown()"
        >
          <ul class="list-group w-100">
            <li
              class="list-group-item autocomplete-item p-1 pl-2"
              style="cursor: pointer"
              *ngFor="let item of list"
              (click)="select(item.name)"
            >
              {{ item.name }}
            </li>
          </ul>
        </div>
      </div>

      <div
        [class.readonly-value]="editMode"
        *ngIf="
          (viewMode || config.read_only) &&
          config.type !== 'static' &&
          config.templateOptions.type !== 'score'
        "
      >
        {{ displayValue }}
      </div>

      <div *ngIf="config.templateOptions.addon" class="addon">
        <fa-icon
          *ngIf="config.templateOptions.addon.indexOf('.') === -1"
          [icon]="['fas', config.templateOptions.addon]"
        ></fa-icon>
        <img
          *ngIf="config.templateOptions.addon.indexOf('.') > -1"
          [src]="config.templateOptions.addon"
        />
      </div>

      <button
        *ngIf="config.key === 'password' && config.templateOptions.addon"
        class="password"
        (click)="switchType(config.templateOptions.type)"
      >
        <svg
          width="17px"
          height="17px"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 511.999 511.999"
        >
          <path
            d="M508.745,246.041c-4.574-6.257-113.557-153.206-252.748-153.206S7.818,239.784,3.249,246.035
         c-4.332,5.936-4.332,13.987,0,19.923c4.569,6.257,113.557,153.206,252.748,153.206s248.174-146.95,252.748-153.201
         C513.083,260.028,513.083,251.971,508.745,246.041z M255.997,385.406c-102.529,0-191.33-97.533-217.617-129.418
         c26.253-31.913,114.868-129.395,217.617-129.395c102.524,0,191.319,97.516,217.617,129.418
         C447.361,287.923,358.746,385.406,255.997,385.406z"
          />

          <path
            d="M255.997,154.725c-55.842,0-101.275,45.433-101.275,101.275s45.433,101.275,101.275,101.275
         s101.275-45.433,101.275-101.275S311.839,154.725,255.997,154.725z M255.997,323.516c-37.23,0-67.516-30.287-67.516-67.516
         s30.287-67.516,67.516-67.516s67.516,30.287,67.516,67.516S293.227,323.516,255.997,323.516z"
          />
        </svg>
      </button>

      <span
        *ngIf="
          config.type === 'static' && config.templateOptions.type !== 'score'
        "
        [ngClass]="config.templateOptions.color"
        [ngStyle]="{
          fontWeight: config.templateOptions.bold ? 'bold' : 'normal'
        }"
      >
        {{ displayValue }}
      </span>

      <div
        class="rating"
        *ngIf="
          (viewMode || config.read_only) &&
          config.templateOptions.type === 'score' &&
          (parseScore(config.value) || !config.templateOptions.danger)
        "
      >
        <ngb-rating [rate]="config.value" max="5" [readonly]="true">
          <ng-template let-fill="fill" let-index="index">
            <span *ngIf="fill === 100" class="star full">&#9733;</span>
            <span *ngIf="fill === 0" class="star">&#9733;</span>
            <span *ngIf="fill < 100 && fill > 0" class="star">
              <span class="half" [style.width.%]="fill">&#9733;</span>&#9733;
            </span>
          </ng-template>
        </ngb-rating>
      </div>

      <div
        class="text-danger"
        *ngIf="
          (viewMode || config.read_only) &&
          config.templateOptions.type === 'score' &&
          !parseScore(config.value) &&
          config.templateOptions.danger
        "
      >
        {{ config.templateOptions.danger }}
      </div>
    </div>
  </div>
  <div *ngIf="errors">
    <div class="text-danger mt-1" *ngIf="errors[config.key]">
      {{ errors[config.key] }}
    </div>
  </div>
  <div *ngIf="message">
    <div *ngIf="message[config.key]" class="text-success mt-1">
      {{ message[config.key] }}
    </div>
  </div>
</div>

<ng-template #inputField>
  <input
    #input
    class="form-control"
    appInputFocus
    autocomplete="off"
    [class.pl-2]="config.templateOptions.icon"
    [class.not-empty]="group.get(key).value"
    [class.addon-input]="config.templateOptions.addon"
    [formControl]="group.get(key)"
    [attr.type]="
      config.templateOptions.type
        ? (config.templateOptions.type === 'score' && 'number') ||
          config.templateOptions.type
        : 'text'
    "
    [attr.id]="key"
    [attr.name]="key"
    [attr.placeholder]="config.templateOptions.placeholder || ''"
    [readonly]="config.read_only"
    [value]="
      config.value === 0 || config.value
        ? config.value
        : group.get(key).value === 0 || group.get(key).value
        ? group.get(key).value
        : ''
    "
    (focus)="generateList()"
    (keyup)="filter(key)"
  />
</ng-template>

<ng-template #addressField>
  <input
    type="text"
    class="form-control"
    id="autocomplete"
    #adr
    ngx-google-places-autocomplete
    [(ngModel)]="address"
    [ngModelOptions]="{ standalone: true }"
    [attr.id]="key"
    [attr.name]="key"
    (onAddressChange)="getAddress($event, adr.value)"
  />
</ng-template>

<ng-template #scoreField>
  <ngb-rating
    *ngIf="
      !viewMode && !config.read_only && config.templateOptions.type === 'score'
    "
    max="5"
    (hover)="hovered = $event"
    (leave)="hovered = undefined"
    (rateChange)="hovered = undefined"
    [formControl]="group.get(key)"
  >
    <ng-template let-fill="fill" let-index="index">
      <span
        *ngIf="fill === 100"
        [style.color]="colors[hovered || group.get(key).value]"
        class="star full"
        >&#9733;</span
      >
      <span
        *ngIf="fill === 0"
        [class.text-danger]="!hovered && !group.get(key).value"
        class="star"
        >{{ group.get(key).value ? '&#9733;' : '&#9734;' }}</span
      >
      <span
        *ngIf="fill < 100 && fill > 0"
        [class.text-danger]="!group.get(key).value"
        class="star"
      >
        <span class="half" [style.width.%]="fill">
          {{ group.get(key).value ? '&#9733;' : '&#9734;' }} </span
        >{{ group.get(key).value ? '&#9733;' : '&#9734;' }}</span
      >
    </ng-template>
  </ngb-rating>

  <span
    class="score"
    *ngIf="
      !viewMode && !config.read_only && config.templateOptions.type === 'score'
    "
    [style.borderColor]="colors[hovered || group.get(key).value]"
    [style.color]="colors[hovered || group.get(key).value]"
  >
    <span *ngIf="!hovered && !group.get(key).value" class="text-danger">
      {{ config.templateOptions.noneValue }}
    </span>
    <span
      class="d-flex align-items-center"
      *ngIf="hovered || group.get(key).value"
    >
      &nbsp;
      {{ hovered || group.get(key).value | number: '1.1-1' }}
      &nbsp;
      <fa-icon [icon]="['fas', 'star']"></fa-icon>
    </span>
  </span>
</ng-template>

<ng-template #phoneField>
  <ngx-intl-tel-input
    [(ngModel)]="intl"
    [ngModelOptions]="{ standalone: true }"
    [cssClass]="'custom'"
    [preferredCountries]="preferredCountries"
    [enableAutoCountrySelect]="false"
    [enablePlaceholder]="true"
    [searchCountryFlag]="true"
    [searchCountryField]="[SearchCountryField.Iso2, SearchCountryField.Name]"
    [selectFirstCountry]="false"
    [selectedCountryISO]="CountryISO.Australia"
    [maxLength]="15"
    [tooltipField]="TooltipLabel.Name"
    [phoneValidation]="true"
    [separateDialCode]="separateDialCode"
    (ngModelChange)="onChangePhoneNumber($event)"
    name="phone"
  >
  </ngx-intl-tel-input>
</ng-template>
