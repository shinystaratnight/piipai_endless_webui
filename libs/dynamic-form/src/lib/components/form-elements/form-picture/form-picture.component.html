<div class="form-group" *ngIf="!config.hide">
  <div class="form-element" [class.custom]="config.custom">
    <label class="form-element-label" [class.required]="config.templateOptions.required" [hidden]="config.custom" *ngIf="
        label &&
        config.templateOptions.label &&
        config.key !== 'contact.picture'
      ">
      {{ getTranslationKey(config.key,'label') | translate: {"Default": config.templateOptions.label} }}:
    </label>
    <br>
    <app-info *ngIf="config.templateOptions.description" [description]="getTranslationKey('description') | translate: {'Default': config.templateOptions.description || ''}"></app-info>
    <input
      #picture
      accept="image/*,application/pdf"
      [attr.type]="'file'"
      [hidden]="true"
      [attr.id]="key"
      (change)="fileChangeEvent($event)" [attr.name]="key"
    />
    <ng-container *ngIf="config.key === 'contact.picture' && !config.candidateForm">
      <ng-container *ngTemplateOutlet="pictureView"></ng-container>
    </ng-container>

    <ng-container *ngIf="config.key !== 'contact.picture' || config.candidateForm">
      <div class="form-element-picture">
        <img
          *ngIf="value && config.templateOptions.file === false"
          class="image-preview"
          [class.signature]="config.templateOptions.signature"
          [class.start]="config.templateOptions.start"
          [src]="value"
          alt="image"
        />

        <img
          *ngIf="value && config.templateOptions.file === false"
          class="image-profile"
          [class.origin]="config.companyContact"
          [src]="value"
          alt="image"
          width="200"
          height="200"
        />
        <div *ngIf="contactAvatar && !fileName && !value" class="contact-avatar">
          {{ contactAvatar }}
        </div>

        <ng-container *ngIf="(link || value) && config.templateOptions.file == undefined">
          <a class="document" [href]="link || value" target="_blank">
            <fa-icon [icon]="['fas', 'file']" class="file-icon"></fa-icon>
            <fa-icon [icon]="['fas', 'download']" class="download-icon"></fa-icon>
            View document
          </a>
          <a *ngIf="!viewMode" class="link" href="" (click)="upload($event)">{{'upload_file' | translate}}</a>
        </ng-container>

        <span *ngIf="!value && !contactAvatar && !link && viewMode">-</span>
        <span *ngIf="!link && !value && !viewMode && !config.read_only && config.templateOptions.file == undefined" class="link ml-0 mr-auto" (click)="upload()"
        >
            {{'upload_file' | translate: {"Default": 'Upload new file'} }}
        </span>
        <div *ngIf="
            !viewMode &&
            !config.read_only &&
            config.templateOptions.file === false
          " class="d-flex align-items-center flex-wrap mt-1">
          <div class="btn-group flex-wrap">
            <button type="button" class="btn btn-default" (click)="upload()" title="Choose a file">
              <fa-icon icon="upload"></fa-icon>
            </button>
            <button type="button" class="btn btn-default" (click)="open()" title="Take a photo">
              <fa-icon icon="camera"></fa-icon>
            </button>
            <button *ngIf="value" type="button" class="btn btn-default" (click)="removeImage()" title="Remove">
              <fa-icon icon="trash"></fa-icon>
            </button>
            <button *ngIf="(fileName || isRemoved) && config.candidateForm && !sizeError" type="button"
              class="btn btn-default" (click)="patchPicture()" title="Update">
              <fa-icon icon="check"></fa-icon>
            </button>
          </div>

        </div>

        <div class="mt-1" style="overflow: hidden; text-overflow: ellipsis; max-width: 180px"
          *ngIf="fileName && !config.read_only && !config.view">
          <i class="text-muted">{{'file' | translate: {"Default": 'File'} }}:</i> {{ fileName }}
        </div>
      </div>
    </ng-container>
  </div>
  <div *ngIf="errors">
    <div class="text-danger mt-1" *ngIf="errors[key]">{{ errors[key] }}</div>
  </div>
  <div class="text-danger mt-1 text-left" *ngIf="sizeError">
    {{'file_size' | translate: {"Default": 'File size is too large!'} }} <br>
    {{'max_size' | translate: {"Default": 'Maximum allowed file size is 10 Mb.'} }}
  </div>
  <div *ngIf="message">
    <div *ngIf="message[key]" class="text-success mt-1">{{ message[key] }}</div>
  </div>
</div>

<ng-template #modal let-c="close">
  <div class="modal-header">
    <h5 class="modal-title">{{ getTranslationKey(config.key,'label_photo') | translate: {"Default": config.templateOptions.label_photo} }}</h5>

    <app-close-button class="ml-auto" (click)="c()"></app-close-button>
  </div>

  <div class="modal-body picture d-flex justify-content-around flex-wrap" style="overflow: auto">
    <!-- <app-webcam class="d-flex align-items-center" [options]="options" [onSuccess]="onSuccess" [onError]="onError">
    </app-webcam> -->
    <webcam
      width="300"
      height="200"
      class="d-flex align-items-center"
      [captureImageData]="true"
      [trigger]="capture$"
      (imageCapture)="onImageCapture($event)">
    </webcam>

    <div class="photo d-flex justify-content-center align-items-center mt-3 mt-sm-0">
      <span *ngIf="!photoExist" class="text-white">
        {{'photo' | translate: {"Default": 'Photo'} }}
      </span>
      <img *ngIf="photoExist" [src]="this.base64" alt="">
      <!-- <canvas [hidden]="!photoExist"></canvas> -->
    </div>
  </div>

  <div class="modal-footer justify-content-start">
    <button *ngIf="photoExist" type="button" class="btn btn-success" (click)="save(c)">
      {{'save' | translate: {"Default": 'Save'} }}
    </button>
    <button type="button" class="btn btn-primary" (click)="getPhoto()">
      {{
        photoExist
          ? ('try_again' | translate: {"Default": 'Try again'})
          : (getTranslationKey(config.key,'label_photo') | translate: {"Default": config.templateOptions.label_photo}) || ('take_a_photo' | translate: {"Default": 'Take a photo'})
      }}
    </button>
    <button type="button" class="btn btn-secondary" (click)="c()">
      {{'cancel' | translate: {"Default": 'Cancel'} }}
    </button>
  </div>
</ng-template>

<ng-template #pictureView>
  <div class="d-flex flex-wrap">
    <div class="text-center dropzone-wrapper">
      <label class="dropzone-name" [class.required]="config.templateOptions.required">
        {{'add_photo' | translate: {"Default": 'Add photo'} }}
      </label>
      <div class="dropzone" #dropzone>
        <img *ngIf="value" [src]="value" alt="" width="100" height="100" />
      </div>
    </div>
    <div class="d-flex flex-column justify-content-center">
      <span class="description">{{'drag_and_drop' | translate}}</span>
      <div class="d-flex align-items-center buttons-wrapper">
        <button class="btn action mr-2" (click)="upload()">{{'add_photo' | translate: {"Default": 'Add photo'} }}</button>
        <button class="btn action" (click)="open()">{{'use_camera' | translate: {"Default": 'Use camera'} }}</button>
      </div>
    </div>
  </div>
</ng-template>
