<div class="filter-element">
  <webui-filter-header
    [label]="config.label"
    [key]="config.key"
    [resetButton]="!!query"
    (resetEvent)="resetFilter()"
  >
  </webui-filter-header>

  <div class="filter-related">
    <div
      class="
        d-flex
        justify-content-center
        align-items-center
        autocomplete-filter
      "
      style="position: relative"
    >
      <div
        class="form-control autocomplete-value"
        [class.active]="
          (multiple && selected && selected.length) ||
          (!multiple && item && item.data)
        "
        (click)="openAutocomplete($event)"
      >
        <div style="overflow: hidden; white-space: nowrap">
          <span *ngIf="multiple && selected.length"
            >{{ 'selected' | translate: { Default: 'Selected' } }}&nbsp;</span
          >
          <span *ngIf="multiple && !selected.length"
            >{{ 'select' | translate: { Default: 'Select' } }}&nbsp;</span
          >
          <span *ngIf="!multiple && !selected.length && item && !item.data">{{
            'all' | translate: { Default: 'All' }
          }}</span>

          <span *ngIf="multiple && selected.length"
            >{{ selected.length }}&nbsp;</span
          >

          <span *ngIf="multiple">{{
            getTranslateKey() | translate: { Default: config.label }
          }}</span>

          <span *ngIf="!multiple && item && item.data">
            {{ item.displayValue }}
          </span>
        </div>
        <fa-icon
          [icon]="item && item.hideAutocomplete ? 'chevron-down' : 'chevron-up'"
          class="text-md-white ml-2"
        ></fa-icon>
      </div>

      <div
        class="autocomplete"
        [hidden]="item ? item.hideAutocomplete : true"
        [ngStyle]="{ 'top.px': topHeight }"
      >
        <input
          #search="ngModel"
          *ngIf="!multiple"
          name="search"
          type="text"
          class="form-control mb-1"
          [(ngModel)]="searchValue"
          [ngModelOptions]="{ standalone: true }"
          (blur)="resetList()"
        />
        <ul *ngIf="multiple" class="list-group w-100">
          <li class="autocomplete-item default-value">
            <a (click)="selectAll(previewList)">{{
              'select_all' | translate: { Default: 'Select All' }
            }}</a>
            <a (click)="resetAll(previewList)">{{
              'reset_all' | translate: { Default: 'Reset All' }
            }}</a>
          </li>
        </ul>

        <input
          #search="ngModel"
          *ngIf="multiple"
          name="search"
          type="text"
          class="form-control mt-1"
          [(ngModel)]="searchValue"
          [ngModelOptions]="{ standalone: true }"
        />

        <div
          class="autocomplete-list"
          infinite-scroll
          [infiniteScrollDistance]="modalScrollDistance"
          [infiniteScrollThrottle]="modalScrollThrottle"
          [scrollWindow]="false"
          (scrolled)="onModalScrollDown()"
        >
          <ul
            *ngIf="!multiple && previewList && previewList.length"
            class="list-group w-100"
          >
            <li
              class="list-group-item autocomplete-item"
              (click)="setValue(defaultValue, item)"
            >
              {{ 'all' | translate: { Default: 'All' } }}
            </li>
            <li
              class="list-group-item autocomplete-item"
              *ngFor="let option of previewList"
              (click)="setValue(option, previewList)"
            >
              {{ option.__str__ }}
            </li>
          </ul>

          <ul
            *ngIf="multiple && previewList && previewList.length"
            class="list-group w-100"
          >
            <li
              class="list-group-item autocomplete-item form-check"
              *ngFor="let option of previewList; let index = index"
            >
              <label class="d-flex align-items-center">
                <input
                  type="checkbox"
                  class="form-check-input"
                  [(ngModel)]="option.checked"
                  name="checked"
                  (ngModelChange)="setValue(option, chashValues)"
                  hidden
                />
                <webui-checkbox
                  [sm]="true"
                  [checked]="option.checked"
                ></webui-checkbox>
                {{ option[config.data.value] }}
              </label>
            </li>
          </ul>
          <div
            class="d-flex align-items-center justify-content-center"
            *ngIf="skipScroll"
          >
            <webui-loader></webui-loader>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="selected && selected.length" class="filter-values">
      <span class="badge badge-outline" *ngFor="let value of selected">
        {{ value[config.data.value] }}
        <fa-icon
          [icon]="['fas', 'times']"
          (click)="removeItem(value)"
        ></fa-icon>
      </span>
    </div>
  </div>
</div>
