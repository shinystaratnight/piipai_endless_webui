<div class="calendar-header">
  <h2 class="mr-auto">Calendar</h2>

  <div class="btn-group range-buttons" btnRadioGroup [formControl]="currentRange">
    <label [btnRadio]="range.Month" role="button"  [class.active]="isMonthRange">Month</label>
    <label [btnRadio]="range.Week" role="button"  [class.active]="isWeekRange">Week</label>
    <label [btnRadio]="range.Day" role="button"  [class.active]="isDayRange">Day</label>
  </div>

  <div class="range-title-wrapper">
    <button type="button" class="prev" (click)="changeRange(false)">
      <i fa name="chevron-left"></i>
    </button>

    <span class="range-title">{{rangeTitle}}</span>

    <button type="button" class="next" (click)="changeRange(true)">
      <i fa name="chevron-right"></i>
    </button>
  </div>
</div>

<div class="filters"></div>

<div class="calendar">
  <ng-container *ngIf="isMonthRange">
    <ng-container *ngTemplateOutlet="monthCalendar"></ng-container>
  </ng-container>

  <ng-container *ngIf="isWeekRange">
    <ng-container *ngTemplateOutlet="weekCalendar"></ng-container>
  </ng-container>

  <ng-container *ngIf="isDayRange">
    <ng-container *ngTemplateOutlet="dayCalendar"></ng-container>
  </ng-container>
</div>

<ng-template #monthCalendar>
  <div class="grid-row">
    <span class="grid-item header-item" *ngFor="let day of calendarData?.header">{{day}}</span>
  </div>
  <div class="grid-row" *ngFor="let week of calendarData?.body">
    <ng-container *ngFor="let day of week">
      <span *ngIf="!day.tooltip" class="grid-item month-day"><span class="date">{{day.label}}</span></span>

      <span class="grid-item month-day"
        *ngIf="day.tooltip"
        [class.active]="day.isOpen"
        triggers="click:click"
        [ngbTooltip]="monthTooltip"
        placement="bottom"
        (shown)="day.isOpen = true"
        (hidden)="day.isOpen = false">

        <span class="date">{{day.label}}</span>

        <div class="shift-groups">
          <div *ngIf="day.tooltip[1].length" class="badge badge-success">{{day.tooltip[1].length}}</div>
          <div *ngIf="day.tooltip[0].length" class="badge badge-danger">{{day.tooltip[0].length}}</div>
          <div *ngIf="day.tooltip[2].length" class="badge badge-warning">{{day.tooltip[2].length}}</div>
        </div>

        <ng-template #monthTooltip>
          <div class="shift-tooltip">
            <ng-container *ngTemplateOutlet="shiftGroup; context: {shifts: day.tooltip[1], className: 'success', name: 'Filled'}"></ng-container>

            <ng-container *ngTemplateOutlet="shiftGroup; context: {shifts: day.tooltip[0], className: 'danger', name: 'Unfilled'}"></ng-container>

            <ng-container *ngTemplateOutlet="shiftGroup; context: {shifts: day.tooltip[2], className: 'warning', name: 'Pending'}"></ng-container>
          </div>
        </ng-template>
      </span>
    </ng-container>

  </div>
</ng-template>

<ng-template #weekCalendar>
  <div class="grid-row">
    <span class="grid-item header-item" *ngFor="let day of calendarData?.header">{{day}}</span>
  </div>
</ng-template>

<ng-template #dayCalendar>
  <div class="grid-row">
    <span class="grid-item header-item" *ngFor="let day of calendarData?.header">{{day}}</span>
  </div>
</ng-template>

<ng-template #shiftGroup let-shifts="shifts" let-className="className" let-name="name">
  <div class="mb-3" *ngIf="shifts.length">
    <p class="shift-tooltip-title">
      {{name}} <span [ngClass]="'badge badge-' + className">{{shifts.length}}</span>
    </p>

    <div class="shift-name" *ngFor="let shift of shifts">
      <i fa name="circle" [ngClass]="'mr-2 text-' + className"></i>
      {{shift.name}}
    </div>
  </div>
</ng-template>
