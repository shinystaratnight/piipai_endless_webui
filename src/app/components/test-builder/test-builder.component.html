<div class="test-builder">

  <ng-content></ng-content>

  <hr>

  <div class="questions-item" *ngFor="let item of questions; let index = index">
    <h6 class="description description-title">Question #{{index + 1}}</h6>

    <i fa name="trash" class="text-danger" (click)="deleteQuestion(getId(item), questions, index)"></i>

    <template [ngTemplateOutlet]="question" [ngOutletContext]="{config: item, index: index}"></template>
  </div>

  <button type="button" class="btn btn-sm btn-success questions-button"
    *ngIf="testData"
    (click)="addQuestion(true)">
      Add Question
  </button>

  <button type="button" class="btn btn-sm btn-primary" *ngIf="testData" (click)="showPreview()">
    Show Preview
  </button>

</div>

<template #question let-config="config" let-index="index">
  <dynamic-form
    [config]="config"
    (submit)="saveQuestion($event, index, getId(config))">
  </dynamic-form>

  <ng-container *ngIf="getId(config) && getType(config) !== 1">

    <div class="answers-item" *ngFor="let item of answers[getId(config)]; let index = index">
      <h6 class="description description-title">Answer #{{index + 1}}</h6>

      <i fa name="trash" class="text-danger" (click)="deleteAnswer(getId(item), answers[getId(config)], index)"></i>

      <template [ngTemplateOutlet]="answer" [ngOutletContext]="{config: item, index: index, id: getId(config)}"></template>
    </div>

    <button type="button" class="btn btn-sm btn-success answers-button"
      *ngIf="testData && checkCount(getType(config), answers[getId(config)].length)"
      (click)="addAnswer(true, answers[getId(config)])">
        Add Answer
    </button>
  </ng-container>
</template>

<template #answer let-config="config" let-index="index" let-id="id">
  <dynamic-form
    [config]="config"
    (submit)="saveAnswer($event, index, id, getId(config))">
  </dynamic-form>
</template>

<template #preview let-c="close">
  <div class="modal-content-wrapper">
    <div class="modal-header-wrapper">
      <div class="modal-header">
        <button type="button" class="close ml-auto" aria-label="Close" (click)="c()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
    <div class="modal-body">
      <test-generator [id]="testData.id"></test-generator>
    </div>
  </div>
</template>
