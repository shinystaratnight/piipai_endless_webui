<navigation [user]="user" [pages]="pagesList" (update)="updateNavigationList($event)"></navigation>

<div class="site-page" *ngIf="pageData && !dashboard" [ngSwitch]="pageData.pathData.type">
  <div *ngSwitchCase="'form'" class="form-page">
    <div class="form-content"
      *ngIf="!reload && pageData.endpoint !== '/ecore/api/v2/core/forms/' || pageData.pathData.postfix === 'submit'">
      <div [class.modal-form]="pageData.pathData.modal">
        <generic-form
          *ngIf="!reload && pageData.endpoint !== '/ecore/api/v2/core/forms/' && !pageData.pathData.postfix || pageData.pathData.postfix === 'submit'"
          [title]="pageData.pathData.title"
          [modal]="pageData.pathData.modal"
          [endpoint]="pageData.endpoint"
          [id]="pageData.pathData.id"
          [edit]="pageData.pathData.postfix"
          [mode]="formMode"
          (event)="formEvent($event)"
          (modeEvent)="modeEvent($event)"
          (errorForm)="formError($event)"
          (str)="changeFormLabel($event)">
            <div class="d-flex">
              <button type="button" class="btn button-delete custom-button"
                *ngIf="pageData.pathData.id && checkPermission('delete')"
                (click)="deleteElement(pageData)">
                  <i fa name="trash"></i>
                  Delete
              </button>

              <button type="button" class="btn close button-close"
                *ngIf="formMode === 'edit'"
                (click)="changeMode('view')">
                  Close without save
              </button>

              <button type="button" class="btn btn-primary btn-shadow ml-auto button-edit"
                *ngIf="formMode === 'view' && checkPermission('update')"
                (click)="changeMode('edit')">
                  <i fa name="pencil"></i>
                  Edit mode
              </button>

              <button type="submit" class="btn btn-primary button-save"
                *ngIf="!formStorage && formMode !== 'view' && (checkPermission('post') || checkPermission('update'))"
                [disabled]="saveProcess">
                  Save
                  <spinner *ngIf="saveProcess"></spinner>
              </button>

              <button type="button" class="btn btn-success mr-2 ml-auto"
                *ngIf="formStorage && !approvedStorage && formMode === 'edit' && checkPermission('post')"
                (click)="approveFormStorage(pageData)">
                  Approve
              </button>
            </div>
        </generic-form>

        <fill-in
          *ngIf="pageData.pathData.postfix && pageData.pathData.postfix === 'fillin'"
          [endpoint]="pageData.endpoint"
          [pageData]="pageData">
        </fill-in>
      </div>
    </div>
    <form-builder
      *ngIf="pageData.endpoint === '/ecore/api/v2/core/forms/'"
      [path]="pageData.pathData.path"
      [endpoint]="pageData.endpoint"
      [id]="pageData.pathData.id"
      (str)="changeFormLabel($event)">
    </form-builder>
  </div>

  <div class="datatable-list" *ngSwitchCase="'list'">
    <generic-list [allowPermissions]="permissionMethods" [endpoint]="pageData.endpoint"></generic-list>
  </div>

  <div *ngSwitchCase="'profile'">
    <profile [id]="user.data.contact.contact_id"></profile>
  </div>
</div>

<dashboard *ngIf="dashboard"
  [pages]="pagesList"
  [userModules]="userModules"
  [modulesList]="modulesList"
  (changeWidgetList)="updateNavigation($event)"></dashboard>
