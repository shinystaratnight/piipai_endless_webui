<navigation
  logo="/assets/img/new-software.svg"
  [user]="user"
  [pages]="pagesList"
  (update)="updateNavigationList($event)"
  (changePasswordEmitter)="openChangePassword()">
</navigation>

<div class="site-page" *ngIf="pageData && !dashboard" [ngSwitch]="pageData.pathData.type">
  <div *ngSwitchCase="'form'" class="form-page">
    <div *ngIf="listName && !(pageData.pathData.postfix && pageData.pathData.postfix === 'fillin')" class="form-navigation">
      <a [routerLink]="pageData.pathData.path">
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="12px" height="6px" style="transform: rotate(90deg)" viewBox="0 0 612 612" xml:space="preserve">
          <path stroke-width="2" stroke="green" d="M604.501,134.782c-9.999-10.05-26.222-10.05-36.221,0L306.014,422.558L43.721,134.782
           c-9.999-10.05-26.223-10.05-36.222,0s-9.999,26.35,0,36.399l279.103,306.241c5.331,5.357,12.422,7.652,19.386,7.296
           c6.988,0.356,14.055-1.939,19.386-7.296l279.128-306.268C614.5,161.106,614.5,144.832,604.501,134.782z"/>
        </svg>

        Back to {{listName | lowercase}} list
      </a>
    </div>

    <div class="form-content"
      *ngIf="!reload && !(pageData.endpoint === '/ecore/api/v2/acceptance-tests/acceptancetests/' && pageData.pathData.id) && pageData.endpoint !== '/ecore/api/v2/core/forms/' || pageData.pathData.postfix === 'submit'">
        <generic-form
          *ngIf="!reload && pageData.endpoint !== '/ecore/api/v2/core/forms/' && !pageData.pathData.postfix || pageData.pathData.postfix === 'submit' "
          [endpoint]="pageData.endpoint"
          [id]="pageData.pathData.id"
          [edit]="pageData.pathData.postfix"
          [mode]="formMode"
          [errors]="errors"
          [data]="additionalData"
          [path]="pageData.pathData.path"
          (event)="formEvent($event)"
          (modeEvent)="modeEvent($event)"
          (errorForm)="formError($event)"
          (str)="changeFormLabel($event)">
            <div class="d-flex">
              <button type="button" class="btn button-delete custom-button"
                *ngIf="pageData.pathData.id && checkPermission('delete')"
                (click)="deleteElement(pageData)">
                  <i fa name="trash"></i>
                  Delete
              </button>

              <button type="button" class="btn close button-close"
                *ngIf="formMode === 'edit'"
                (click)="changeMode('view')">
                  Close without save
              </button>

              <button type="button" class="btn btn-primary btn-shadow ml-auto button-edit"
                *ngIf="formMode === 'view' && checkPermission('update')"
                (click)="changeMode('edit')">
                  <i fa name="pencil"></i>
                  Edit mode
              </button>

              <button type="submit" class="btn btn-primary button-save"
                *ngIf="!formStorage && formMode !== 'view' && (checkPermission('post') || checkPermission('update'))"
                [disabled]="saveProcess">
                  Save
                  <spinner *ngIf="saveProcess"></spinner>
              </button>

              <button type="button" class="btn btn-success mr-2 ml-auto"
                *ngIf="formStorage && !approvedStorage && formMode === 'edit' && checkPermission('post')"
                (click)="approveFormStorage(pageData)">
                  Approve
              </button>
            </div>
        </generic-form>

        <fill-in
          *ngIf="pageData.pathData.postfix && pageData.pathData.postfix === 'fillin'"
          [endpoint]="pageData.endpoint"
          [pageData]="pageData">
        </fill-in>
    </div>
    <div class="form-content"
      *ngIf="pageData.endpoint === '/ecore/api/v2/core/forms/'">
        <form-builder
          [path]="pageData.pathData.path"
          [endpoint]="pageData.endpoint"
          [id]="pageData.pathData.id"
          (str)="changeFormLabel($event)">
        </form-builder>
    </div>

    <div class="form-content" *ngIf="!reload && (pageData.endpoint === '/ecore/api/v2/acceptance-tests/acceptancetests/' && pageData.pathData.id)">
      <test-builder [testData]="acceptenceTestData">
          <generic-form
            [endpoint]="pageData.endpoint"
            [id]="pageData.pathData.id"
            [path]="pageData.pathData.path"
            [mode]="formMode"
            (modeEvent)="modeEvent($event)"
            (event)="formEvent($event)"
            (str)="setTestData($event)">
              <div class="d-flex">
                <button type="button" class="btn button-delete custom-button"
                  *ngIf="pageData.pathData.id && checkPermission('delete')"
                  (click)="deleteElement(pageData)">
                    <i fa name="trash"></i>
                    Delete
                </button>

                <button type="button" class="btn close button-close"
                  *ngIf="formMode === 'edit'"
                  (click)="changeMode('view')">
                    Close without save
                </button>

                <button type="button" class="btn btn-primary btn-shadow ml-auto button-edit"
                  *ngIf="formMode === 'view' && checkPermission('update')"
                  (click)="changeMode('edit')">
                    <i fa name="pencil"></i>
                    Edit mode
                </button>

                <button type="submit" class="btn btn-primary button-save"
                  *ngIf="!formStorage && formMode !== 'view' && (checkPermission('post') || checkPermission('update'))"
                  [disabled]="saveProcess">
                    Save
                    <spinner *ngIf="saveProcess"></spinner>
                </button>
              </div>
          </generic-form>
      </test-builder>
    </div>
  </div>

  <div class="datatable-list" *ngSwitchCase="'list'"
    infinite-scroll
    [scrollWindow]="true"
    (scrolled)="onModalScrollDown()">
      <generic-list
        [upload]="upload"
        [clientId]="getClientId()"
        [listNameCache]="listNameCache"
        [allowPermissions]="permissionMethods"
        [endpoint]="pageData.endpoint">
      </generic-list>
  </div>

  <div *ngSwitchCase="'profile'">
    <profile [id]="user.data.contact.contact_id"></profile>
  </div>

  <map *ngSwitchCase="'map'"></map>
</div>

<dashboard *ngIf="dashboard"
  [pages]="pagesList"
  [userModules]="userModules"
  [modulesList]="modulesList"
  (changeWidgetList)="updateNavigation($event)"></dashboard>

<my-toast></my-toast>

<template #modal let-c="close" let-d="dismiss">
  <div class="modal-content-wrapper">
    <div class="modal-header-wrapper">
      <div class="modal-header">
        <h5 class="modal-title">Change Password</h5>
        <button type="button" class="close ml-2" aria-label="Close" (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
    <div class="pb-3 form-builder-form">
      <generic-form endpoint="/ecore/api/v2/password/change/">
        <a class="forgot" href="" (click)="openResetForm()">Forgot Password?</a>
        <div class="d-flex align-items-center">
          <button type="submit" class="btn btn-success ml-auto">Save</button>
        </div>
      </generic-form>
    </div>
  </div>
</template>

<template #forgotPassword let-c="close" let-d="dismiss">
  <div class="modal-content-wrapper">
    <div class="modal-header-wrapper">
      <div class="modal-header">
        <h5 class="modal-title">Password Reset</h5>
        <button type="button" class="close ml-2" aria-label="Close" (click)="d('Cross click')">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    </div>
    <div class="pb-3 form-builder-form">
      <generic-form endpoint="/ecore/api/v2/password/forgot/">
        <div class="d-flex align-items-center">
          <button type="submit" class="btn btn-success ml-auto">Reset</button>
        </div>
      </generic-form>
    </div>
  </div>
</template>
