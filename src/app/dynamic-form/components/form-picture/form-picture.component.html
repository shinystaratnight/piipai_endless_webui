<div class="form-group" *ngIf="!config.hide">
  <div class="form-element" [class.custom]="config.custom">
    <label class="col-form-label form-element-label"
      [class.required]="config.templateOptions.required"
      [hidden]="config.custom"
      *ngIf="label && config.templateOptions.label && config.key !== 'contact.picture'">
        {{config.templateOptions.label}}:
    </label>
    <app-info [description]="config.templateOptions.description"></app-info>
    <input
      #picture
      accept="image/*,application/pdf"
      [attr.type]="'file'"
      [hidden]="true"
      [attr.id]="key"
      (change)="fileChangeEvent($event)"
      [attr.name]="key">
    <ng-container *ngIf="config.key === 'contact.picture'">
      <ng-container *ngTemplateOutlet="pictureView"></ng-container>
    </ng-container>

    <ng-container *ngIf="config.key !== 'contact.picture'">
      <div class="form-element-picture">
        <img class="image-preview" [class.start]="config.templateOptions.start" *ngIf="value && config.templateOptions.file === false" [src]="value" alt="image">
        <div *ngIf="contactAvatar && !fileName && !value" class="contact-avatar">{{contactAvatar}}</div>
        <span *ngIf="(link || value) && viewMode && config.templateOptions.file == undefined">
          {{getExtension(link || fileName ||value) | uppercase}} file
          <a class="link" [href]="link || value" target="_blank">|&nbsp;Open in new tab</a>
        </span>
        <span *ngIf="(link || value) && !viewMode && config.templateOptions.file == undefined">
          <a *ngIf="this.config.value" [href]="link || value" target="_blank">{{getExtension(link || fileName || value) | uppercase}} file</a>
          <a class="link" href="" (click)="upload($event)">|&nbsp;Upload new file</a>
        </span>
        <span *ngIf="!value && !contactAvatar && !link && viewMode ">-</span>
        <span *ngIf="(!link && !value) && !viewMode && !config.read_only && config.templateOptions.file == undefined" class="link ml-0" (click)="upload()">Upload new file</span>
        <div *ngIf="!viewMode && !config.read_only && config.templateOptions.file === false" class="d-flex align-items-center flex-wrap mt-1">
          <button type="button" class="btn btn-primary btn-sm text-white actions"
            (click)="upload()">
            <i fa [name]="'upload'"></i>
            <span *ngIf="config.templateOptions.label_upload">{{config.templateOptions.label_upload}}</span>
          </button>
          <span class="p-1">or</span>
          <button type="button" class="btn btn-success btn-sm text-white actions"
            (click)="open()">
            <i fa [name]="'camera'"></i>
            <span *ngIf="config.templateOptions.label_photo">{{config.templateOptions.label_photo}}</span>
          </button>
        </div>
        <div class="mt-1" *ngIf="fileName && !config.read_only && !config.view"><i class="text-muted">file:</i> {{fileName}}</div>
      </div>
    </ng-container>
  </div>
  <div *ngIf="errors">
    <div class="text-danger mt-1" *ngIf="errors[key]">{{errors[key]}}</div>
  </div>
  <div class="text-danger mt-1" *ngIf="sizeError">{{sizeError}}</div>
  <div *ngIf="message">
    <div *ngIf="message[key]" class="text-success mt-1">{{message[key]}}</div>
  </div>
</div>

<ng-template #modal let-c="close">
  <div class="modal-header">
    <h5 class="modal-title">{{config.templateOptions.label_photo}}</h5>
    <button type="button" class="close" (click)="c()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body picture d-inline-block d-flex justify-content-around flex-wrap" style="overflow: auto">
    <app-webcam class="d-flex align-items-center" [options]="options" [onSuccess]="onSuccess" [onError]="onError"></app-webcam>
    <div class="photo d-flex justify-content-center align-items-center">
      <span *ngIf="!photoExist" class="text-white">Photo</span>
      <canvas [hidden]="!photoExist"></canvas>
    </div>
  </div>

  <div class="modal-footer justify-content-start">
    <button *ngIf="photoExist" type="button" class="btn btn-success" (click)="save(c)">Save</button>
    <button type="button" class="btn btn-primary" (click)="getPhoto()">{{photoExist ? 'Try again' : config.templateOptions.label_photo || 'Take a photo'}}</button>
    <button type="button" class="btn btn-secondary" (click)="c()">Cancel</button>
  </div>
</ng-template>

<ng-template #pictureView>
  <div class="d-flex flex-wrap">
    <div class="text-center dropzone-wrapper">
      <label class="dropzone-name"
        [class.required]="config.templateOptions.required">
          Add photo
      </label>
      <div class="dropzone" #dropzone>
        <img *ngIf="value" [src]="value" alt="" width="100" height="100">
      </div>
    </div>
    <div class="d-flex flex-column justify-content-center">
      <span class="description">Drag the photo to the area or click the button</span>
      <div class="d-flex align-items-center buttons-wrapper">
        <button class="btn action mr-2" (click)="upload()">Add photo</button>
        <button class="btn action" (click)="open()">Use camera</button>
      </div>
    </div>
  </div>
</ng-template>
