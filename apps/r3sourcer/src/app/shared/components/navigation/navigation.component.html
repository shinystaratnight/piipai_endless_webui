<header #header class="page-header">
  <button
    class="d-flex align-items-center hamburger hamburger--spring d-xl-none"
    type="button"
    *ngIf="pages && pages.length"
    [ngClass]="{ 'is-active': isCollapsed }"
    (click)="showNavigation($event)"
  >
    <span class="hamburger-box">
      <span class="hamburger-inner"></span>
    </span>
  </button>

  <a class="logo" routerLink="/">
    <img class="logo-img" *ngIf="logo" [src]="logo" />
  </a>

  <nav
    #nav
    class="navigation order-0"
    [ngClass]="{ 'flex-first': pages }"
    *ngIf="pages && pages.length"
  >
    <ul
      class="navigation-list navigation-list-parent"
      [ngClass]="{ show: isCollapsed }"
      [ngStyle]="{ 'top.px': isCollapsed ? headerHeight : 0 }"
    >
      <ng-container *ngFor="let page of pages">
        <ng-container
          *ngTemplateOutlet="
            item;
            context: { page: page, first: true, height: headerHeight }
          "
        ></ng-container>
      </ng-container>
    </ul>
  </nav>

  <webui-time
    *ngIf="user"
    class="time"
    translateKey="local_time"
    description="Local time"
    [hidden]="!initTime"
    (init)="initTime = true"
  ></webui-time>

  <webui-language-selector class="language-selector"></webui-language-selector>

  <div #userBlock class="user" *ngIf="user" (click)="toggleUserBlock($event)">
    <div class="user-block">
      <img
        class="user-avatar"
        *ngIf="picture"
        [src]="picture"
        width="50px"
        height="50px"
      />
      <div *ngIf="contactAvatar" class="user-avatar">
        {{ contactAvatar }}
      </div>

      <div class="user-preview">
        <div class="user-role-information">
          <h4 class="user-name text-primary">{{ fullName }}</h4>
          <p class="user-position">
            {{ getRolePosition(currentRoleObject) }}
          </p>
        </div>

        <span class="text-primary dropdown-icon">
          <webui-icon
            [icon]="Icon.ArrowDown"
            [size]="IconSize.Medium"
          ></webui-icon>
        </span>
      </div>
    </div>

    <div *ngIf="!hideUserMenu" class="user-menu">
      <a
        *ngFor="let role of roles"
        href="https://{{ role.domain }}"
        class="user-menu__role"
        [class.active]="role.id === currentRole"
        (click)="changeRole(role, $event)"
      >
        <span class="user-menu__role-indicator"></span>

        <img
          class="user-avatar"
          *ngIf="picture"
          [src]="picture"
          width="50px"
          height="50px"
        />
        <div *ngIf="contactAvatar" class="user-avatar">
          {{ contactAvatar }}
        </div>

        <div class="user-preview">
          <div class="user-role-information">
            <h4 class="user-name text-primary">{{ fullName }}</h4>
            <p class="user-position">
              {{ getRolePosition(role) }}
            </p>
          </div>
        </div>
      </a>

      <div class="user-menu__section">
        <a class="link" routerLink="/cd/profile" *ngIf="candidate">
          {{ 'profile' | translate: { Default: 'Profile' } }}
        </a>

        <a class="link" href="" (click)="changePassword()">
          {{ 'change_password' | translate: { Default: 'Change password' } }}
        </a>

        <button type="button" class="button button--primary" (click)="logOut()">
          {{ 'log_out' | translate: { Default: 'Log out' } }}
        </button>
      </div>
    </div>
  </div>
</header>

<ng-template #list let-p="pages" let-h="height">
  <ul *ngIf="!isCollapsed && p.length" class="navigation-list-nested">
    <ng-container *ngFor="let page of p">
      <ng-container
        *ngTemplateOutlet="item; context: { page: page }"
      ></ng-container>
    </ng-container>
  </ul>
  <ul *ngIf="isCollapsed && p.length" class="navigation-list-nested">
    <ng-container *ngFor="let page of p">
      <ng-container
        *ngTemplateOutlet="item; context: { page: page }"
      ></ng-container>
    </ng-container>
  </ul>
</ng-template>

<ng-template #item let-p="page" let-f="first" let-h="height">
  <li
    class="navigation-item"
    [class.disabled]="p.disabled"
    [class.opened]="p.opened"
  >
    <a
      *ngIf="!p.disabled"
      [routerLink]="
        p.url !== '/'
          ? [checkUrlPrefix(p.url) ? urlPrefix + p.url : p.url]
          : null
      "
      class="navigation-link"
      [class.active]="p.active"
      (click)="clickAction($event, p)"
    >
      {{ p.translateKey | translate: { Default: p.name } }}
    </a>
    <span
      class="navigation-link disabled"
      *ngIf="p.disabled"
      (click)="isCollapsed = false"
      [attr.title]="getDisableTitle(p.name)"
    >
      {{ p.translateKey | translate: { Default: p.name } }}
    </span>
    <fa-icon
      class="icon"
      [class.active]="p.active"
      [icon]="['fas', 'circle']"
    ></fa-icon>

    <fa-icon
      class="icon-link"
      [class.extend]="p.children && p.children.length"
      [icon]="['fas', p.opened ? 'minus' : 'plus']"
    >
    </fa-icon>

    <ng-container *ngIf="p.children && f">
      <ng-container
        *ngTemplateOutlet="list; context: { pages: p.children, height: h }"
      ></ng-container>
    </ng-container>

    <ng-container *ngIf="p.children && !f">
      <ng-container
        *ngTemplateOutlet="list; context: { pages: p.children }"
      ></ng-container>
    </ng-container>
  </li>
</ng-template>
