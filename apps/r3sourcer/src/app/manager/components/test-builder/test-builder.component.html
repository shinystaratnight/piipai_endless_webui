<div class="test-builder">

  <ng-content></ng-content>

  <hr>

  <div class="questions-item" *ngFor="let item of questions; let index = index">
    <h6 class="description description-title">Question #{{index + 1}}</h6>

    <fa-icon icon="trash" class="text-danger hov-opacity" (click)="deleteQuestion(getId(item), questions, index)"></fa-icon>
    <fa-icon icon="pencil-alt" class="text-warning hov-opacity ml-2" (click)="editQuestion(item)"></fa-icon>

    <ng-container *ngTemplateOutlet="question; context: {config: item, index: index}"></ng-container>
  </div>

  <button type="button" class="btn btn-sm btn-success questions-button mr-2"
    *ngIf="testData"
    (click)="addQuestion(true)">
      Add Question
  </button>

  <button type="button" class="btn btn-sm btn-primary" *ngIf="testData" (click)="showPreview()">
    Show Preview
  </button>

</div>

<ng-template #question let-config="config" let-index="index">
  <app-dynamic-form
    [config]="config"
    (submitForm)="saveQuestion($event, index, getId(config))">
  </app-dynamic-form>

  <ng-container *ngIf="getId(config) && getType(config) !== 1">

    <div class="answers-item" *ngFor="let item of answers[getId(config)]; let index = index">
      <h6 class="description description-title">Answer #{{index + 1}}</h6>

      <fa-icon icon="trash" class="text-danger hov-opacity" (click)="deleteAnswer(getId(item), answers[getId(config)], index)"></fa-icon>
      <fa-icon icon="pencil-alt" class="text-warning hov-opacity ml-2" (click)="editAnswer(item)"></fa-icon>

      <ng-container *ngTemplateOutlet="answer; context: {config: item, index: index, id: getId(config)}"></ng-container>
    </div>

    <button type="button" class="btn btn-sm btn-success answers-button"
      *ngIf="testData && checkCount(getType(config), answers[getId(config)].length)"
      (click)="addAnswer(true, answers[getId(config)])">
        Add Answer
    </button>
  </ng-container>
</ng-template>

<ng-template #answer let-config="config" let-index="index" let-id="id">
  <app-dynamic-form
    [config]="config"
    (submitForm)="saveAnswer($event, index, id, getId(config))">
  </app-dynamic-form>
</ng-template>
