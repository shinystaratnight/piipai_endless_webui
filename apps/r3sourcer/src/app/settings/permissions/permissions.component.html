<div class="permissions">
  <ul ngbNav type="pills" (tabChange)="beforeChange()">
    <li [ngbNavItem]="'group'">
      <a ngbNavLink>Groups</a>
      <ng-template ngbTabContent>
        <div class="permission-block-add form-inline">
          <input type="text" class="permission-input form-control mr-2" [(ngModel)]="name">
          <button type="button" class="btn bg-light" (click)="addGroup(name)">Add</button>
        </div>
        <div class="permission-wrapper">
          <ng-container *ngTemplateOutlet="list; context: {title: 'Groups', list: groups, param: 'name', element: 'group', type: 'list'}"></ng-container>
          <ng-container *ngIf="targetId">
              <ng-container *ngTemplateOutlet="list; context: {title: 'Permissions', list: permissionsList, param: 'name', element: 'group', type: 'permission'}"></ng-container>
          </ng-container>
        </div>
      </ng-template>
    </li>
    <li [ngbNavItem]="'user'">
      <a ngbNavLink>Users</a>
      <ng-template ngbTabContent>
        <div class="permission-wrapper">
          <ng-container *ngTemplateOutlet="list; context: {title: 'Users', list: users, param: 'name', element: 'user', type: 'list'}"></ng-container>
          <ng-container *ngIf="targetId">
            <ng-container *ngTemplateOutlet="list; context: {title: 'Permissions', list: permissionsList, param: 'name', element: 'user', type: 'permission'}"></ng-container>
            <ng-container *ngTemplateOutlet="list; context: {title: 'Groups', list: userGroups, param: 'name', element: 'user', type: 'group'}"></ng-container>
          </ng-container>
        </div>
      </ng-template>
    </li>
  </ul>
</div>

<ng-template #list let-t="title" let-l="list" let-p="param" let-a="actions" let-type="type" let-e="element">
  <div class="permission-block-wrapper">
    <b class="permission-block-title">{{t}}:</b>
    <div class="permission-search">
      <input type="text"
        [(ngModel)]="search[type]"
        class="form-control w-100 mb-2"
        (keyup)="filter(search[type], type, l, e)">
      <fa-icon [icon]="['fas', 'search']" class="permission-search-icon text-muted"></fa-icon>
    </div>
    <div class="permission-block">
      <div class="permission-item"
        [class.active]="item.active"
        [class.selected]="item.id === targetId && type === 'list'"
        *ngFor="let item of l"
        (click)="toggle(type, e, item)">
          {{item[p]}}
          <fa-icon
            class="permission-icon text-danger"
            *ngIf="e === 'group' && type === 'list'"
            [icon]="['fas', 'trash']"
            (click)="removeGroup(item, $event)">
          </fa-icon>
        </div>
    </div>
    <div *ngIf="type === 'permission'" class="d-flex m-2 align-items-center">
      <button class="btn btn-success mr-2" (click)="selectAll(e)">Select All</button>
      <button class="btn btn-danger" (click)="removeAll(e)">Remove All</button>
    </div>
  </div>
</ng-template>
